<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√în T·∫≠p C√¢u 4 Th√†nh Ph·∫ßn - L·ªõp 4A Th·∫ßy Tuy·∫øn</title>
    <link rel="icon" href="https://img.icons8.com/color/48/school.png" type="image/png">
    
    <style>
        :root {
            --primary-color: #2563eb; /* M√†u xanh gi√°o d·ª•c */
            --success-color: #22c55e;
            --error-color: #ef4444;
            --bg-color: #f0f9ff;
            --card-bg: #ffffff;
            --text-color: #1e293b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: transparent;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            padding: 30px 20px;
            border-radius: 20px;
            box-shadow: 0 10px 25px -5px rgba(37, 99, 235, 0.4);
        }

        h1 {
            margin: 0;
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sub-title {
            margin-top: 10px;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .student-info {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }

        .student-info input {
            padding: 12px 20px;
            border: none;
            border-radius: 50px;
            width: 80%;
            max-width: 350px;
            font-size: 1rem;
            outline: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .question-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--primary-color);
            transition: transform 0.2s;
        }

        .question-card:hover {
            transform: translateY(-3px);
        }

        .question-number {
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: block;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .question-text {
            font-size: 1.15rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .option-label:hover {
            background-color: #f1f5f9;
            border-color: var(--primary-color);
        }

        input[type="radio"] {
            margin-right: 15px;
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
        }

        /* Tr·∫°ng th√°i ƒë√∫ng/sai */
        .option-label.correct {
            background-color: #dcfce7;
            border-color: var(--success-color);
            color: #14532d;
        }

        .option-label.incorrect {
            background-color: #fee2e2;
            border-color: var(--error-color);
            color: #7f1d1d;
        }

        .explanation {
            margin-top: 20px;
            padding: 15px;
            background-color: #eff6ff;
            border-radius: 8px;
            display: none;
            font-size: 0.95rem;
            color: #1e40af;
        }

        .btn-submit {
            background: linear-gradient(135deg, #2563eb, #2563eb);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            display: block;
            margin: 40px auto;
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            max-width: 300px;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 25px rgba(37, 99, 235, 0.4);
        }

        .btn-submit:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Popup k·∫øt qu·∫£ */
        #result-area {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 20px 20px 0 0;
            display: none;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.15);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .score-display {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #fff;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
            display: none;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Responsive Mobile */
        @media (max-width: 600px) {
            body { padding: 10px; }
            h1 { font-size: 1.4rem; }
            .container { padding-bottom: 120px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>B√ÄI √îN T·∫¨P C√ÇU 4 TH√ÄNH PH·∫¶N</h1>
        <div class="sub-title">Th·ªùi gian - ƒê·ªãa ƒëi·ªÉm - Ch·ªß ng·ªØ - Ho·∫°t ƒë·ªông</div>
        <div class="sub-title" style="margin-top: 5px; font-weight: bold;">L·ªõp 4A - Th·∫ßy Phan VƒÉn Tuy·∫øn</div>
        
        <div class="student-info">
            <input type="text" id="studentName" placeholder="Nh·∫≠p h·ªç v√† t√™n c·ªßa em..." required autocomplete="off">
        </div>
    </header>

    <form id="quizForm">
        <div id="questions-container"></div>
        
        <button type="button" class="btn-submit" id="submitBtn" onclick="window.submitQuiz()">
            <div class="loader" id="btnLoader"></div>
            <span id="btnText">N·ªòP B√ÄI</span>
        </button>
    </form>
</div>

<div id="result-area">
    <div id="result-text" class="score-display"></div>
    <div style="margin-top:10px; font-size: 0.95rem;" id="db-status"></div>
    <div style="margin-top:20px;">
        <button onclick="document.getElementById('result-area').style.display='none'" 
                style="padding: 10px 30px; border-radius: 20px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer; font-weight: bold;">
            Xem l·∫°i b√†i l√†m
        </button>
    </div>
</div>

<script type="module">
    // 1. Import th∆∞ vi·ªán Firebase (Phi√™n b·∫£n m·ªõi nh·∫•t)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    // 2. C·∫•u h√¨nh Firebase (L·∫•y t·ª´ d·ª± √°n baikiemtracuoiki)
    const firebaseConfig = {
        apiKey: "AIzaSyA77lLi_JCLIdR535KEfg3S0_Ge2EorPMo",
        authDomain: "baikiemtracuoiki.firebaseapp.com",
        projectId: "baikiemtracuoiki",
        storageBucket: "baikiemtracuoiki.firebasestorage.app",
        messagingSenderId: "953819948776",
        appId: "1:953819948776:web:4e9a017a6c5fc10ed28b5d",
        measurementId: "G-KHRHMJQ9DT"
    };

    // 3. Kh·ªüi t·∫°o k·∫øt n·ªëi
    let db;
    try {
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        db = getFirestore(app);
        console.log("K·∫øt n·ªëi th√†nh c√¥ng t·ªõi: baikiemtracuoiki");
    } catch (e) {
        console.error("L·ªói k·∫øt n·ªëi Firebase:", e);
    }

    // 4. D·ªØ li·ªáu c√¢u h·ªèi (20 c√¢u)
    const questions = [
        { id: 1, text: "C√¢u n√†o d∆∞·ªõi ƒë√¢y tu√¢n th·ªß ƒë√∫ng c·∫•u tr√∫c: Th·ªùi gian + ƒê·ªãa ƒëi·ªÉm + Ch·ªß ng·ªØ + Ho·∫°t ƒë·ªông?", options: ["S√°ng nay, m·∫π em ƒëi ch·ª£ t·∫°i si√™u th·ªã.", "·ªû s√¢n tr∆∞·ªùng, s√°ng th·ª© hai, ch√∫ng em ch√†o c·ªù.", "S√°ng th·ª© hai, ·ªü s√¢n tr∆∞·ªùng, ch√∫ng em ch√†o c·ªù.", "Ch√∫ng em ch√†o c·ªù s√°ng th·ª© hai ·ªü s√¢n tr∆∞·ªùng."], correct: 2, explain: "ƒê√°p √°n ƒë√∫ng l√† C: S√°ng th·ª© hai (TG) + ·ªü s√¢n tr∆∞·ªùng (ƒêƒê) + ch√∫ng em (CN) + ch√†o c·ªù (Hƒê)." },
        { id: 2, text: "Trong c√°c c√¢u sau, c√¢u n√†o vi·∫øt ƒë√∫ng theo c√¥ng th·ª©c ƒë√£ h·ªçc?", options: ["H√¥m qua, tr√™n c√†nh c√¢y, ch√∫ chim h√≥t l√≠u lo.", "Ch√∫ chim h√≥t l√≠u lo tr√™n c√†nh c√¢y h√¥m qua.", "Tr√™n c√†nh c√¢y, h√¥m qua, ch√∫ chim h√≥t l√≠u lo.", "H√¥m qua, ch√∫ chim h√≥t l√≠u lo tr√™n c√†nh c√¢y."], correct: 0, explain: "ƒê√°p √°n ƒë√∫ng l√† A." },
        { id: 3, text: "X√°c ƒë·ªãnh c√¢u ƒë√∫ng c·∫•u tr√∫c: Th·ªùi gian + ƒê·ªãa ƒëi·ªÉm + Ch·ªß ng·ªØ + Ho·∫°t ƒë·ªông.", options: ["M√πa h√®, ve k√™u r√¢m ran trong v√≤m l√°.", "Trong v√≤m l√°, m√πa h√®, ve k√™u r√¢m ran.", "M√πa h√®, trong v√≤m l√°, ve k√™u r√¢m ran.", "Ve k√™u r√¢m ran trong v√≤m l√° v√†o m√πa h√®."], correct: 2, explain: "ƒê√°p √°n ƒë√∫ng l√† C." },
        { id: 4, text: "ƒêi·ªÅn t·ª´ ch·ªâ TH·ªúI GIAN: \"....., tr√™n c√°nh ƒë·ªìng, c√°c b√°c n√¥ng d√¢n ƒëang g·∫∑t l√∫a.\"", options: ["·ªû nh√†", "ChƒÉm ch·ªâ", "Bu·ªïi s√°ng", "Con tr√¢u"], correct: 2, explain: "\"Bu·ªïi s√°ng\" l√† t·ª´ ch·ªâ th·ªùi gian." },
        { id: 5, text: "Ch·ªçn t·ª´ ch·ªâ TH·ªúI GIAN: \"....., t·∫°i ph√≤ng kh√°ch, c·∫£ nh√† em qu√¢y qu·∫ßn xem tivi.\"", options: ["T·ªëi h√¥m qua", "Tr√™n gh·∫ø sofa", "Vui v·∫ª", "B·ªë m·∫π"], correct: 0, explain: "\"T·ªëi h√¥m qua\" l√† th·ªùi gian ph√π h·ª£p." },
        { id: 6, text: "ƒêi·ªÅn t·ª´ ch·ªâ TH·ªúI GIAN: \"....., d∆∞·ªõi s√¢n tr∆∞·ªùng, h·ªçc sinh n√¥ ƒë√πa vui v·∫ª.\"", options: ["Gi·ªù ra ch∆°i", "L·ªõp h·ªçc", "Quy·ªÉn s√°ch", "Nhanh nh·∫πn"], correct: 0, explain: "\"Gi·ªù ra ch∆°i\" l√† m·ªëc th·ªùi gian." },
        { id: 7, text: "Ch·ªçn t·ª´ ch·ªâ ƒê·ªäA ƒêI·ªÇM: \"S√°ng ch·ªß nh·∫≠t, ....., m·∫π d·∫Øt em ƒëi mua s√°ch.\"", options: ["v√†o l√∫c 8 gi·ªù", "t·∫°i nh√† s√°ch", "chi·∫øc xe ƒë·∫°p", "vui v·∫ª"], correct: 1, explain: "\"T·∫°i nh√† s√°ch\" l√† ƒë·ªãa ƒëi·ªÉm." },
        { id: 8, text: "ƒêi·ªÅn t·ª´ ch·ªâ ƒê·ªäA ƒêI·ªÇM: \"ƒê√™m r·∫±m, ....., ch√∫ng em ph√° c·ªó trung thu.\"", options: ["gi·ªØa s√¢n ƒë√¨nh", "ng√†y mai", "ch·ªã H·∫±ng", "m√∫a l√¢n"], correct: 0, explain: "\"Gi·ªØa s√¢n ƒë√¨nh\" l√† ƒë·ªãa ƒëi·ªÉm." },
        { id: 9, text: "Ch·ªçn t·ª´ ch·ªâ ƒê·ªäA ƒêI·ªÇM: \"Gi·ªù T·∫≠p ƒë·ªçc, ....., c√¥ gi√°o ƒëang say s∆∞a gi·∫£ng b√†i.\"", options: ["tr√™n b·ª•c gi·∫£ng", "bu·ªïi s√°ng", "quy·ªÉn v·ªü", "ngo√†i ƒë∆∞·ªùng"], correct: 0, explain: "C√¥ gi√°o gi·∫£ng b√†i \"tr√™n b·ª•c gi·∫£ng\"." },
        { id: 10, text: "Ch·ªçn CH·ª¶ NG·ªÆ th√≠ch h·ª£p: \"S√°ng s·ªõm, tr√™n ng·ªçn c√¢y, ..... h√≥t l√≠u lo.\"", options: ["con m√®o", "ch√∫ chim s·∫ª", "chi·∫øc l√°", "√¥ng m·∫∑t tr·ªùi"], correct: 1, explain: "Ch·ªâ c√≥ \"ch√∫ chim s·∫ª\" m·ªõi bi·∫øt h√≥t." },
        { id: 11, text: "ƒêi·ªÅn CH·ª¶ NG·ªÆ: \"Chi·ªÅu qua, t·∫°i b·ªÉ b∆°i, ..... ƒëang t·∫≠p b∆°i.\"", options: ["quy·ªÉn s√°ch", "b√© Lan", "c√°i b√†n", "b·∫ßu tr·ªùi"], correct: 1, explain: "\"B√© Lan\" l√† ng∆∞·ªùi c√≥ th·ªÉ t·∫≠p b∆°i." },
        { id: 12, text: "Ch·ªçn CH·ª¶ NG·ªÆ: \"M√πa xu√¢n, trong v∆∞·ªùn, ..... ƒëua nhau khoe s·∫Øc.\"", options: ["ch√∫ chim", "ƒë√†n c√°", "mu√¥n lo√†i hoa", "c√°c b·∫°n nh·ªè"], correct: 2, explain: "\"Mu√¥n lo√†i hoa\" khoe s·∫Øc." },
        { id: 13, text: "Ch·ªçn HO·∫†T ƒê·ªòNG: \"V√†o gi·ªù To√°n, trong l·ªõp, h·ªçc sinh .....\"", options: ["chƒÉm ch√∫ l√†m b√†i", "ng·ªß say s∆∞a", "ƒë√° b√≥ng", "xem tivi"], correct: 0, explain: "H·ªçc sinh \"chƒÉm ch√∫ l√†m b√†i\"." },
        { id: 14, text: "ƒêi·ªÅn HO·∫†T ƒê·ªòNG: \"S√°ng ch·ªß nh·∫≠t, ngo√†i c√¥ng vi√™n, √¥ng b√† em .....\"", options: ["ƒëang ƒëi t·∫≠p th·ªÉ d·ª•c", "ƒëang n·∫•u c∆°m", "ƒëang ng·ªß", "ƒëang h·ªçc b√†i"], correct: 0, explain: "Ra c√¥ng vi√™n \"t·∫≠p th·ªÉ d·ª•c\"." },
        { id: 15, text: "Ch·ªçn HO·∫†T ƒê·ªòNG: \"ƒê√™m giao th·ª´a, tr√™n b·∫ßu tr·ªùi, ph√°o hoa .....\"", options: ["n·ªü r·ª±c r·ª°", "ch·∫°y nh·∫£y", "h√≥t l√≠u lo", "b∆°i l·ªôi"], correct: 0, explain: "Ph√°o hoa \"n·ªü r·ª±c r·ª°\"." },
        { id: 16, text: "S·∫Øp x·∫øp ƒë√∫ng: \"ƒëang gi·∫£ng b√†i / C√¥ gi√°o / tr√™n b·ª•c gi·∫£ng / S√°ng th·ª© hai /.\"", options: ["C√¥ gi√°o ƒëang gi·∫£ng b√†i tr√™n b·ª•c gi·∫£ng S√°ng th·ª© hai.", "S√°ng th·ª© hai, tr√™n b·ª•c gi·∫£ng, C√¥ gi√°o ƒëang gi·∫£ng b√†i.", "Tr√™n b·ª•c gi·∫£ng S√°ng th·ª© hai C√¥ gi√°o ƒëang gi·∫£ng b√†i.", "S√°ng th·ª© hai C√¥ gi√°o ƒëang gi·∫£ng b√†i tr√™n b·ª•c gi·∫£ng."], correct: 1, explain: "ƒê√∫ng: TG -> ƒêƒê -> CN -> Hƒê." },
        { id: 17, text: "Th·ª© t·ª± s·∫Øp x·∫øp ƒë√∫ng l√† g√¨? (1) ngo√†i ƒë·ªìng / (2) Bu·ªïi s√°ng / (3) c√†y ru·ªông / (4) b√°c n√¥ng d√¢n", options: ["2 - 1 - 4 - 3", "4 - 3 - 2 - 1", "1 - 2 - 4 - 3", "2 - 4 - 3 - 1"], correct: 0, explain: "Bu·ªïi s√°ng (2), ngo√†i ƒë·ªìng (1), b√°c n√¥ng d√¢n (4) c√†y ru·ªông (3)." },
        { id: 18, text: "Ch·ªçn c√¢u s·∫Øp x·∫øp ƒë√∫ng: \"ƒëang ƒÉn c·ªè / ƒë√†n b√≤ / Chi·ªÅu t√† / tr√™n tri·ªÅn ƒë√™\".", options: ["Chi·ªÅu t√†, tr√™n tri·ªÅn ƒë√™, ƒë√†n b√≤ ƒëang ƒÉn c·ªè.", "ƒê√†n b√≤ ƒëang ƒÉn c·ªè tr√™n tri·ªÅn ƒë√™ chi·ªÅu t√†.", "Tr√™n tri·ªÅn ƒë√™, chi·ªÅu t√†, ƒë√†n b√≤ ƒëang ƒÉn c·ªè.", "Chi·ªÅu t√† ƒë√†n b√≤ ƒëang ƒÉn c·ªè tr√™n tri·ªÅn ƒë√™."], correct: 0, explain: "ƒê√∫ng: TG -> ƒêƒê -> CN -> Hƒê." },
        { id: 19, text: "V·ªõi t·ª´ g·ª£i √Ω \"ng∆∞·ªùi m·∫π\", c√¢u n√†o d∆∞·ªõi ƒë√¢y hay v√† ƒë√∫ng c·∫•u tr√∫c nh·∫•t?", options: ["Ng∆∞·ªùi m·∫π ƒëang n·∫•u ƒÉn trong b·∫øp t·ªëi nay.", "T·ªëi nay, trong b·∫øp, ng∆∞·ªùi m·∫π ƒëang n·∫•u b·ªØa c∆°m ngon.", "Trong b·∫øp t·ªëi nay ng∆∞·ªùi m·∫π ƒëang n·∫•u ƒÉn.", "Ng∆∞·ªùi m·∫π t·ªëi nay n·∫•u ƒÉn trong b·∫øp."], correct: 1, explain: "C√¢u B ƒë·∫ßy ƒë·ªß v√† ƒë√∫ng th·ª© t·ª±." },
        { id: 20, text: "V·ªõi g·ª£i √Ω \"b·∫ßu tr·ªùi trong xanh\", h√£y ch·ªçn c√¢u ƒë√∫ng c·∫•u tr√∫c:", options: ["M√πa thu, tr√™n cao, b·∫ßu tr·ªùi trong xanh kh√¥ng m·ªôt g·ª£n m√¢y.", "B·∫ßu tr·ªùi trong xanh v√†o m√πa thu tr√™n cao.", "Tr√™n cao m√πa thu b·∫ßu tr·ªùi trong xanh.", "B·∫ßu tr·ªùi m√πa thu tr√™n cao trong xanh."], correct: 0, explain: "C√¢u A ƒë√∫ng c·∫•u tr√∫c." }
    ];

    // 5. H√†m Render Giao di·ªán
    function renderQuiz() {
        const container = document.getElementById('questions-container');
        let html = '';
        questions.forEach((q, index) => {
            html += `
                <div class="question-card" id="card-${index}">
                    <span class="question-number">C√¢u ${q.id}</span>
                    <div class="question-text">${q.text}</div>
                    <div class="options">
                        ${q.options.map((opt, i) => `
                            <label class="option-label" id="lbl-${index}-${i}">
                                <input type="radio" name="q${index}" value="${i}">
                                ${opt}
                            </label>
                        `).join('')}
                    </div>
                    <div class="explanation" id="explain-${index}">
                        <strong>üí° Gi·∫£i th√≠ch:</strong> ${q.explain}
                    </div>
                </div>
            `;
        });
        container.innerHTML = html;
    }

    // 6. H√†m N·ªôp b√†i
    async function submitQuiz() {
        const studentName = document.getElementById('studentName').value.trim();
        if (!studentName) {
            alert("Em h√£y nh·∫≠p t√™n tr∆∞·ªõc khi n·ªôp b√†i nh√©!");
            document.getElementById('studentName').focus();
            window.scrollTo({ top: 0, behavior: 'smooth' });
            return;
        }

        const btn = document.getElementById('submitBtn');
        const loader = document.getElementById('btnLoader');
        const btnText = document.getElementById('btnText');
        const dbStatus = document.getElementById('db-status');
        
        // Kh√≥a n√∫t
        btn.disabled = true;
        loader.style.display = 'inline-block';
        btnText.innerText = 'ƒêang ch·∫•m ƒëi·ªÉm...';

        let score = 0;
        let detailResult = [];

        // Ch·∫•m ƒëi·ªÉm
        questions.forEach((q, index) => {
            const selected = document.querySelector(`input[name="q${index}"]:checked`);
            const explanation = document.getElementById(`explain-${index}`);
            
            // Reset m√†u s·∫Øc
            q.options.forEach((_, i) => {
                const label = document.getElementById(`lbl-${index}-${i}`);
                if(label) label.classList.remove('correct', 'incorrect');
            });

            let studentAnswer = -1;
            if (selected) {
                studentAnswer = parseInt(selected.value);
                const selectedLabel = document.getElementById(`lbl-${index}-${studentAnswer}`);
                
                if (studentAnswer === q.correct) {
                    score++;
                    selectedLabel.classList.add('correct');
                } else {
                    selectedLabel.classList.add('incorrect');
                    document.getElementById(`lbl-${index}-${q.correct}`).classList.add('correct');
                }
            } else {
                 // N·∫øu kh√¥ng ch·ªçn th√¨ ch·ªâ hi·ªán ƒë√°p √°n ƒë√∫ng
                 document.getElementById(`lbl-${index}-${q.correct}`).classList.add('correct');
            }
            
            // Hi·ªán gi·∫£i th√≠ch
            explanation.style.display = 'block';

            detailResult.push({
                cau_so: q.id,
                dap_an_chon: studentAnswer,
                dap_an_dung: q.correct
            });
        });

        // Hi·ªÉn th·ªã Popup k·∫øt qu·∫£
        const resultArea = document.getElementById('result-area');
        const resultText = document.getElementById('result-text');
        resultArea.style.display = 'block';
        resultText.innerHTML = `Ch√∫c m·ª´ng ${studentName}!<br>Em ƒë·∫°t ${score} / ${questions.length} ƒëi·ªÉm.`;

        // G·ª¨I K·∫æT QU·∫¢ V·ªÄ FIREBASE
        // L∆∞u v√†o Collection: "on_tap_cau_4_thanh_phan"
        if (db) {
            btnText.innerText = 'ƒêang l∆∞u k·∫øt qu·∫£...';
            try {
                await addDoc(collection(db, "on_tap_cau_4_thanh_phan"), {
                    ho_ten: studentName,
                    diem_so: score,
                    tong_cau_hoi: questions.length,
                    thoi_gian_nop: serverTimestamp(),
                    chi_tiet_bai_lam: detailResult
                });
                dbStatus.innerHTML = "<span style='color:#16a34a; font-weight:bold'>‚úî B√†i l√†m c·ªßa em ƒë√£ ƒë∆∞·ª£c g·ª≠i cho Th·∫ßy Tuy·∫øn!</span>";
            } catch (error) {
                console.error("L·ªói g·ª≠i:", error);
                dbStatus.innerHTML = `<span style='color:red'>‚ö† L·ªói g·ª≠i b√†i. (Em h√£y b√°o th·∫ßy ki·ªÉm tra l·∫°i m·ª•c Rules tr√™n Firebase nh√©).<br><small>${error.message}</small></span>`;
            }
        } else {
            dbStatus.innerHTML = "<span style='color:red'>L·ªói: Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c CSDL.</span>";
        }

        // M·ªü l·∫°i n√∫t (ƒë·ªÉ n·ªôp l·∫°i n·∫øu mu·ªën)
        btn.disabled = false;
        loader.style.display = 'none';
        btnText.innerText = 'N·ªòP L·∫†I';
    }

    // ƒê∆∞a h√†m ra ngo√†i global scope ƒë·ªÉ n√∫t HTML g·ªçi ƒë∆∞·ª£c
    window.submitQuiz = submitQuiz;

    // Ch·∫°y app
    renderQuiz();
</script>

</body>
</html>
